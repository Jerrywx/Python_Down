{% extends "base.html" %}

{% block style %}
<link rel="stylesheet" href="static/company.css">
{% end %}

{% block body %}

<form method="post" action="companyEdit">

<!-- 导航 -->
<div class="nav">
    <!--<button class="add" type="button" onclick="test()">添加</button>-->
    <!--<a href="company" class="add">确定</a>-->
    <input type="submit" value="确定" class="add">
</div>

<div class="add_info">

    <div class="header">
        <img class="header_icon" src="../static/image/header.png" height="120">

        <div class="header_info">
            <h1>公司名称:</h1>
                <input value="漫威漫画公司" name="name_cn">
            <h1>外文名称:</h1>
                <input value="Marvel Comics" name="name_en"> <br/>
            <h1>总部地点:</h1>
                <input value="美国-纽约" name="address">
            <h1>成立时间:</h1>
                <input value="1939年" name="time"> <br/>

            <h1>经营范围:</h1>
                <input value="漫画出版" name="job">
            <h1>公司性质:</h1>
                <input value="漫画出版公司" name="type"> <br/>
            <h1>母公司　:</h1>
                <input value="华特迪士尼公司" name="p_company">
            <h1>创立者　:</h1>
                <input value="马丁·古德曼" name="person"> <br/>

        </div>
        <!--公司名称 漫威漫画公司 外文名称 Marvel Comics 总部地点美国-纽约 成立时间 1939年-->
        <!--经营范围 漫画出版 公司性质 漫画出版公司 母公司华特迪士尼公司 创立者马丁·古德曼-->
    </div>

    <div class="introduction">
        <h1>简介:</h1>

        <textarea name="desc">
            漫威漫画公司（Marvel Comics）是美国与DC漫画公司（Detective Comics）齐名的漫画巨头，它创建于1939年，于1961年正式定名为Marvel，旧译为“惊奇漫画”，曾用名“时代漫画”（Timely Comics）、亚特拉斯漫画（Atlas Comics）。[1]
1939年4月，公司在《电影连环画周刊》创刊号上创造出了世界上第一位变种人超级英雄——纳摩，这是MARVEL的第一位超级英雄，他比公司的成立还要早半年，同年10月，公司在《惊奇漫画》第1期上创造出世界上第一位生化人超级英雄——初代霹雳火，并将纳摩引入其中，这水与火的双重合作，打出了MARVEL史上的第一拳。2009年底，MARVEL被华特迪士尼公司以42.4亿美元收购，成为其子公司。2010年9月，MARVEL宣布其正式中文名称为“漫威”。旗下拥有蜘蛛侠、金刚狼、美国队长、钢铁侠、雷神托尔、绿巨人、惊奇队长、死侍、蚁人、黑豹、奇异博士、夜魔侠、惩罚者、杰茜卡·琼斯、卢克·凯奇、铁拳、恶灵骑士、刀锋战士等超级英雄，和复仇者联盟、X战警、神奇四侠、银河护卫队、捍卫者联盟、异人族、光照会等超级英雄团队。[1]
        </textarea>

    </div>

    <!-- -->
    <div class="works">
        <div class="works_nav">
            <h1>作品:</h1>

            <a href="#">添加</a>
            <div class="search_add">

                <input type="text" placeholder="搜索内容" name="movieId" class="searcg_word">
                <input type="submit" value="搜索" class="search_btn" onclick="test()">
                <!--<form action="companyEdit" method="get" class="search_input">-->
                    <!--<input type="text" placeholder="搜索内容" name="movieId">-->
                    <!--<input type="submit" value="搜索" class="search_btn">-->
                <!--</form>-->
            </div>
        </div>

        <div class="works_add_list">

            <table border="1" class="movieList">
                <!--<tr>-->
                    <!--<th>名字</th>-->
                    <!--<th>原名</th>-->
                    <!--<th>评分</th>-->
                    <!--<th>豆瓣Id</th>-->
                    <!--<th width="50px">是否添加</th>-->
                <!--</tr>-->

                <!--{% for item in movieList %}-->
                    <!--<tr>-->
                        <!--<td><a href="moviedetial?movieid={{item.id}}">{{item.movie_name_cn}}</a></td>-->
                        <!--<td>{{item.movie_name_en}}</td>-->
                        <!--<td style="text-align:center">{{item.movie_douban_mark}}</td>-->
                        <!--<td style="text-align:center">{{item.movie_douban_id}}</td>-->
                        <!--<td style="text-align:center"><a href="companyEdit?addId={{item.id}}">添加</a></td>-->
                    <!--</tr>-->
                <!--{% end %}-->

            </table>


            <table border="1" class="movieList">
                <!--<tr>-->
                    <!--<th>名字</th>-->
                    <!--<th>原名</th>-->
                    <!--<th>评分</th>-->
                    <!--<th>豆瓣Id</th>-->
                    <!--<th width="50px">是否添加</th>-->
                <!--</tr>-->

                {% for item in movieList %}
                    <tr>
                        <td><a href="moviedetial?movieid={{item.id}}">{{item.movie_name_cn}}</a></td>
                        <td>{{item.movie_name_en}}</td>
                        <td style="text-align:center">{{item.movie_douban_mark}}</td>
                        <td style="text-align:center">{{item.movie_douban_id}}</td>
                        <td style="text-align:center"><a href="companyEdit?addId={{item.id}}">添加</a></td>
                    </tr>
                {% end %}

            </table>

        </div>

    </div>

</div>

</form>

<script>

    <!-- 搜索电影 -->
    function test() {

        var xmlhttp;
        if (window.XMLHttpRequest)
        {
            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp=new XMLHttpRequest();
        }
        else {
            // IE6, IE5 浏览器执行代码
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {

                // 解析 json
                var jsonData = xmlhttp.responseText;
                var list = JSON.parse(jsonData);

                // 获取 table 标签
                var table_node = document.getElementsByClassName("movieList")[0];

                var table_node2 = document.getElementsByClassName("movieList")[1];
                table_node2.style.display = "none";

                // 删除之前内容
//                var row_list = table_node.childNodes;
//                for (ind=2;ind<row_list.length;ind++) {
//                    var remove_nod = row_list[ind];
//                    table_node.removeChild(remove_nod);
//                }

                while(table_node.hasChildNodes()) {
                    table_node.removeChild(table_node.firstChild);
                }

                // 添加新内容
                for (var i=0; i<list.length; i++) {
                    var obj = list[i];

                    var tr_node = document.createElement("tr");

                    //
                    var td_node = document.createElement("td");
                    td_node.innerHTML = obj.movie_name_cn;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.innerHTML = obj.movie_name_en;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    td_node.innerHTML = obj.movie_douban_mark;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    td_node.innerHTML = obj.movie_douban_id;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    tr_node.appendChild(td_node);

                    var add_btn = document.createElement("a");
                    add_btn.innerHTML = "添加";
                    add_btn.onclick = test2;
                    add_btn.style.tag = obj.id;
                    td_node.appendChild(add_btn);

                    table_node.appendChild(tr_node);
                }
            }
        }

        // 获取搜索词
        var wordElem = document.getElementsByClassName("searcg_word")[0];
        var word = wordElem.value;

        var urlString = "/companyEdit?movieId=" + word;

        xmlhttp.open("GET", urlString, true);
        xmlhttp.send();
    }


    <!-- 添加电影 -->
    function test2() {

        var xmlhttp;
        if (window.XMLHttpRequest)
        {
            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp=new XMLHttpRequest();
        }
        else {
            // IE6, IE5 浏览器执行代码
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function() {
            if (xmlhttp.readyState==4 && xmlhttp.status==200) {

                // 解析 json
                var jsonData = xmlhttp.responseText;
                var list = JSON.parse(jsonData);

                // 获取 table 标签
                var table_node = document.getElementsByClassName("movieList")[0];

                var table_node2 = document.getElementsByClassName("movieList")[1];
                table_node2.style.display = "table";

                // 删除之前内容
//                var row_list = table_node.childNodes;
//                alert(row_list.length)
//                for (ind=2;ind<row_list.length;ind++) {
//                    var remove_nod = row_list[ind];
//                    table_node.removeChild(remove_nod);
//                }
                while(table_node.hasChildNodes()) {
                    table_node.removeChild(table_node.firstChild);
                }

                // 添加新内容
                for (var i=0; i<list.length; i++) {
                    var obj = list[i];

                    var tr_node = document.createElement("tr");

                    //
                    var td_node = document.createElement("td");
                    td_node.innerHTML = obj.movie_name_cn;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.innerHTML = obj.movie_name_en;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    td_node.innerHTML = obj.movie_douban_mark;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    td_node.innerHTML = obj.movie_douban_id;
                    tr_node.appendChild(td_node);

                    //
                    var td_node = document.createElement("td");
                    td_node.style.textAlign = "center";
                    tr_node.appendChild(td_node);

                    var add_btn = document.createElement("a");
                    add_btn.innerHTML = "添加";
                    add_btn.onclick = test2;
                    td_node.appendChild(add_btn);

                    table_node2.appendChild(tr_node);
                }
            }
        }

        // 获取搜索词
        var wordElem = document.getElementsByClassName("searcg_word")[0];
        var word = wordElem.value;

        var urlString = "/companyEdit?addId=" + this.style.tag;

        xmlhttp.open("GET", urlString, true);
        xmlhttp.send();

    }

</script>


{% end %}